<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swipe to Match - Flip Card</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-color: #4682B4; /* Blue accent color for interactivity */
        }

        body {
            background-color: #E0E0E0;
            display: flex;
            margin: 0;
            font-family: 'Roboto', Arial, sans-serif;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            height: 100vh; /* Full viewport height */
            overflow: hidden; /* Prevent scrolling */
            width: 100vw; /* Ensure full viewport width */
        }

        .myCard {
            background-color: transparent;
            width: 90vw;
            max-width: 320px;
            height: 70vh;
            max-height: 480px;
            perspective: 1000px;
            margin: auto; /* Ensures horizontal centering within flex container */
            transition: transform 0.5s ease-out, border-radius 0.3s ease; /* Add transition for border-radius */
            border-radius: 70px; /* Larger, smoother rounded corners */
        }

        .myCard:hover {
            border-radius: 40px; /* Slightly larger border radius on hover for effect */
        }

        .myCard:hover .innerCard {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 0 10px var(--accent-color);
        }

        .myCard.dragging {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            opacity: 0.9;
        }

        .innerCard {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s ease-in-out, scale 0.2s ease, border-radius 0.3s ease; /* Add transition for border-radius */
            transform-style: preserve-3d;
            cursor: pointer;
            border-radius: 35px; /* Match the outer card's radius */
        }

        .innerCard[data-flipped="true"] {
            transform: rotateY(180deg) scale(1.02);
        }

        .frontSide, .backSide {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 35px; /* Larger, smoother rounded corners */
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .frontSide {
            background: linear-gradient(135deg, #D9E6FF 0%, #E6F0FF 100%);
        }

        .backSide {
            background: linear-gradient(135deg, #D9E6FF 0%, #E6F0FF 100%);
            transform: rotateY(180deg);
            pointer-events: auto;
        }

        .frontSide img, .backSide p {
            max-width: 90%;
            max-height: 90%;
            object-fit: cover;
            border-radius: 30px; /* Slightly smaller radius for the image to fit inside the card */
            cursor: grab;
            user-select: none;
        }

        .backSide p {
            font-size: 1.2rem;
            color: #333;
            text-align: center;
            padding: 10px;
            cursor: grab;
        }

        .swipe-hint {
            position: absolute;
            color: #333;
            opacity: 0.3;
            font-size: 2rem;
            pointer-events: none;
        }

        .swipe-left {
            left: 10px;
        }

        .swipe-right {
            right: 10px;
        }

        .flip-hint {
            position: absolute;
            bottom: 15px;
            color: rgba(147, 201, 244, 0.7); /* Lighter blue for the hint */
            font-size: 0.8rem; /* Smaller font size to match the screenshot */
            opacity: 0.8;
            pointer-events: none;
        }

        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .tutorial-overlay p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .tutorial-overlay button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .swipe-feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: var(--accent-color);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .swipe-feedback.show {
            opacity: 1;
        }

        /* Add loader styles for swipe-right feedback */
        .swipe-feedback.loader {
            width: 7em;
            height: 5em;
            position: relative;
            animation: beat 1s infinite;
        }

        .swipe-feedback.loader::before,
        .swipe-feedback.loader::after {
            content: "";
            position: absolute;
            top: -465px;
            width: 50px;
            height: 80px;
            border-radius: 5em 5em 0 0;
            animation: coldblue 1s infinite;
        }

        .swipe-feedback.loader::before {
            left: 50px;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
        }

        .swipe-feedback.loader::after {
            left: 0;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
        }

        @keyframes beat {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        @keyframes coldblue {
            0%, 100% {
                background-color: rgb(255, 255, 255);
            }
            50% {
                background-color: rgb(198, 23, 23);
            }
        }

        @media (max-width: 600px) {
            .myCard {
                width: 85vw;
                height: 60vh;
            }
            .backSide p {
                font-size: 1rem;
                padding: 8px;
            }
            .swipe-hint {
                font-size: 1.5rem;
            }
            .flip-hint {
                font-size: 0.7rem;
                bottom: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="myCard" id="swipeCard" tabindex="0" role="region" aria-label="Interactive swipe card">
        <div class="innerCard" id="innerCard" aria-label="Card content">
            <div class="frontSide" aria-label="Product image">
                <img id="productImage" src="/static/image_test/camera.jpg" alt="Product image" draggable="true">
                <span class="swipe-hint swipe-left"></span>
                <span class="swipe-hint swipe-right"></span>
                <span class="flip-hint">↻ Double-click to flip</span>
            </div>
            <div class="backSide" id="backContent" draggable="true" aria-label="Product details">
                <p class="title" aria-label="Product title">Product Details</p>
                <p id="productDescription" aria-label="Product description">More details about the product.</p>
                <span class="flip-hint">↻ Double-click to flip</span>
            </div>
        </div>
    </div>

    <!-- <div class="tutorial-overlay" id="tutorialOverlay">
        <p>Double-click to flip the card.<br>Swipe left, right, up, or down to navigate.</p>
        <button onclick="document.getElementById('tutorialOverlay').style.display = 'none'">Got it!</button>
    </div> -->

    <script type="py">
        from js import document, window, console
        from pyodide.ffi import create_proxy

        images = ["/static/image_test/camera.jpg", "/static/image_test/guitar.jpg", "/static/image_test/piano.jpg"]
        product_details = [
            {"name": "Camera", "description": "High-quality digital camera for photography", "price": "$499.99"},
            {"name": "Guitar", "description": "Acoustic guitar for beginners and professionals", "price": "$299.99"},
            {"name": "Piano", "description": "Digital piano with 88 keys and weighted action", "price": "$799.99"}
        ]
        current_index = 0
        start_x = 0
        start_y = 0

        def show_next_image():
            global current_index
            current_index = (current_index + 1) % len(images)
            document.getElementById("productImage").src = images[current_index]
            document.getElementById("innerCard").setAttribute("data-flipped", "false")
            update_product_description()

        def update_product_description():
            details = product_details[current_index]
            description_text = f"{details['name']}\n{details['description']}\nPrice: {details['price']}"
            document.getElementById("productDescription").innerText = description_text

        def reset_card():
            document.getElementById("swipeCard").style.transform = "translate(0px, 0px) rotate(0deg)"
            show_next_image()

        def on_drag_start(event):
            global start_x, start_y
            start_x = event.clientX
            start_y = event.clientY
            document.getElementById("swipeCard").classList.add("dragging")

        def on_drag_end(event):
            offset_x = event.clientX - start_x
            offset_y = event.clientY - start_y
            document.getElementById("swipeCard").classList.remove("dragging")
            if offset_x > 100:
                handle_swipe("right")
            elif offset_x < -100:
                handle_swipe("left")
            elif offset_y > 100:
                handle_swipe("down")
            elif offset_y < -100:
                handle_swipe("up")
            else:
                reset_card()

        def handle_swipe(direction):
            card = document.getElementById("swipeCard")
            transforms = {
                "left": "translateX(-300px) rotate(-20deg)",
                "right": "translateX(300px) rotate(20deg)",
                "up": "translateY(-300px)",
                "down": "translateY(300px)"
            }
            card.style.transform = transforms[direction]
            feedback = document.createElement("div")
            feedback.className = "swipe-feedback"
            if direction == "right":
                feedback.classList.add("loader")  # Add loader class for swipe-right
            else:
                feedback.innerText = "Disliked"  # Default text for other directions
            card.appendChild(feedback)
            feedback.classList.add("show")
            window.setTimeout(create_proxy(lambda: feedback.remove()), 500)  # Remove after animation
            window.setTimeout(create_proxy(reset_card), 500)

        def toggle_flip(event):
            inner_card = document.getElementById("innerCard")
            is_flipped = inner_card.getAttribute("data-flipped") == "true"
            inner_card.setAttribute("data-flipped", "false" if is_flipped else "true")

        def on_key_press(event):
            if event.key == "Enter":
                toggle_flip(event)
            elif event.key == "ArrowRight":
                handle_swipe("right")
            elif event.key == "ArrowLeft":
                handle_swipe("left")
            elif event.key == "ArrowUp":
                handle_swipe("up")
            elif event.key == "ArrowDown":
                handle_swipe("down")

        def hide_tutorial():
            tutorial_overlay = document.getElementById("tutorialOverlay")
            if tutorial_overlay:
                tutorial_overlay.style.display = 'none'

        # Initial setup
        try:
            image = document.getElementById("productImage")
            back_content = document.getElementById("backContent")
            inner_card = document.getElementById("innerCard")
            swipe_card = document.getElementById("swipeCard")

            image.addEventListener("dragstart", create_proxy(on_drag_start))
            image.addEventListener("dragend", create_proxy(on_drag_end))
            back_content.addEventListener("dragstart", create_proxy(on_drag_start))
            back_content.addEventListener("dragend", create_proxy(on_drag_end))
            inner_card.addEventListener("dblclick", create_proxy(toggle_flip))
            swipe_card.addEventListener("keydown", create_proxy(on_key_press))

            # Hide tutorial overlay after first interaction or on button click
            tutorial_overlay = document.getElementById("tutorialOverlay")
            if tutorial_overlay:
                window.setTimeout(create_proxy(hide_tutorial), 5000)  # Auto-hide after 5 seconds

            # Initialize with the first product
            update_product_description()
        except Exception as e:
            console.error(f"Error initializing card: {e}")
    </script>
</body>
</html>