<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore - Search Products</title>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', path='/explore-style.css') }}">
    <script type="module" src="https://pyscript.net/releases/2023.11.1/core.js"></script>
    <style>
        .container {
            display: inline-block;
            cursor: pointer;
            position: relative;
        }

        .save-regular, .save-solid {
            height: 1em;
            width: 1em;
            transition: opacity 0.3s ease;
        }

        .save-regular {
            fill: #888; /* Default gray for unchecked state */
            opacity: 1;
        }

        .save-solid {
            fill: #ffd700; /* Yellow for checked state */
            opacity: 0;
        }

        .container input:checked ~ .save-regular {
            opacity: 0;
        }

        .container input:checked ~ .save-solid {
            opacity: 1;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-title">
            <span class="explore-icon"><i class="fas fa-compass"></i></span> Explore
        </div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search products">
            <button class="search-button">Search</button>
        </div>
        <div class="nav-menu">
            <a href="/">Home</a>
            <a href="#">Trending</a>
            <a href="#">Categories</a>
            <a href="#">Contact</a>
        </div>
    </header>

    <div class="main-content">
        <div class="product-grid" id="productGrid">
            <!-- Products will be dynamically added here by PyScript -->
        </div>
        <div class="filter-sidebar">
            <h3>Filter Your Search</h3>
            <div class="filter-category">
                <select id="categorySelect">
                    <option value="all">All</option>
                    <option value="category1">Category 1</option>
                    <option value="category2">Category 2</option>
                </select>
            </div>
            <div class="filter-price">
                <label>Price</label>
                <input type="range" class="slider" min="0" max="100" value="50">
            </div>
            <button class="filter-button">Filter</button>
        </div>
    </div>

    <script type="py">
        from js import document, window
        from pyodide.ffi import create_proxy
    
        # Define product data for each category
        products = {
            "category1": [
                {"name": "Camera", "description": "High-quality digital camera for photography", "price": "$499.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Guitar", "description": "Acoustic guitar for beginners", "price": "$299.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Headphones", "description": "Noise-canceling headphones with premium sound", "price": "$199.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Watch", "description": "Luxury smartwatch with fitness tracking", "price": "$349.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Microphone", "description": "Studio-quality microphone for recording", "price": "$149.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Tablet", "description": "High-resolution tablet for entertainment", "price": "$399.99", "image": "https://via.placeholder.com/280x260"}
            ],
            "category2": [
                {"name": "Piano", "description": "Digital piano with 88 keys and weighted action", "price": "$799.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Laptop", "description": "High-performance laptop for work and gaming", "price": "$1299.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Smartphone", "description": "Latest model smartphone with advanced features", "price": "$699.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Drone", "description": "High-tech drone for aerial photography", "price": "$899.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Speaker", "description": "Portable Bluetooth speaker with deep bass", "price": "$129.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Camera Lens", "description": "Professional camera lens for photography", "price": "$599.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Keyboard", "description": "Mechanical keyboard for gaming", "price": "$89.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Monitor", "description": "4K monitor for design and gaming", "price": "$299.99", "image": "https://via.placeholder.com/280x260"}
            ],
            "all": [
                {"name": "Camera", "description": "High-quality digital camera for photography", "price": "$499.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Guitar", "description": "Acoustic guitar for beginners", "price": "$299.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Piano", "description": "Digital piano with 88 keys and weighted action", "price": "$799.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Laptop", "description": "High-performance laptop for work and gaming", "price": "$1299.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Headphones", "description": "Noise-canceling headphones with premium sound", "price": "$199.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Smartphone", "description": "Latest model smartphone with advanced features", "price": "$699.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Watch", "description": "Luxury smartwatch with fitness tracking", "price": "$349.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Tablet", "description": "High-resolution tablet for entertainment", "price": "$399.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Drone", "description": "High-tech drone for aerial photography", "price": "$899.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Speaker", "description": "Portable Bluetooth speaker with deep bass", "price": "$129.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Camera Lens", "description": "Professional camera lens for photography", "price": "$599.99", "image": "https://via.placeholder.com/280x260"},
                {"name": "Microphone", "description": "Studio-quality microphone for recording", "price": "$149.99", "image": "https://via.placeholder.com/280x260"}
            ]
        }
    
        def update_product_grid(category=None):
            """ Update product grid based on selected category """
            product_grid = document.getElementById("productGrid")
            product_grid.innerHTML = ""  # Clear current products
    
            if category is None or category == "all":
                selected_products = products["all"]
            elif category == "category1":
                selected_products = products["category1"][:6]  # Limit to 6 products
            elif category == "category2":
                selected_products = products["category2"][:8]  # Limit to 8 products
    
            for product in selected_products:
                product_div = document.createElement("div")
                product_div.classList.add("product-item")
    
                img = document.createElement("img")
                img.src = product["image"]
                img.alt = product["name"]
                img.classList.add("product-image")
    
                name = document.createElement("div")
                name.classList.add("product-name")
                name.textContent = product["name"]
    
                description = document.createElement("div")
                description.classList.add("product-description")
                description.textContent = product["description"]
    
                price = document.createElement("div")
                price.classList.add("product-price")
                price.textContent = product["price"]
    
                # Add new SVG flag implementation (starting unchecked)
                flag_container = document.createElement("label")
                flag_container.classList.add("container")
                flag_container.innerHTML = """
                    <input type="checkbox" />
                    <svg class="save-regular" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512">
                        <path d="M0 48C0 21.5 21.5 0 48 0l0 48V441.4l130.1-92.9c8.3-6 19.6-6 27.9 0L336 441.4V48H48V0H336c26.5 0 48 21.5 48 48V488c0 9-5 17.2-13 21.3s-17.6 3.4-24.9-1.8L192 397.5 37.9 507.5c-7.3 5.2-16.9 5.9-24.9 1.8S0 497 0 488V48z"></path>
                    </svg>
                    <svg class="save-solid" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512">
                        <path d="M0 48V487.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400 345.7 507.6c4.1 2.9 9 4.4 14 4.4c13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48z"></path>
                    </svg>
                """
                flag_container.querySelector("input").addEventListener("change", create_proxy(lambda event: toggle_flag(event, flag_container)))
    
                product_div.appendChild(img)
                product_div.appendChild(name)
                product_div.appendChild(description)
                product_div.appendChild(price)
                product_div.appendChild(flag_container)
                product_grid.appendChild(product_div)
    
        def toggle_flag(event, container):
            """ Toggle flag icon animation """
            console.log("Flag toggled")
    
        def on_category_change(event):
            """ Handle category selection change """
            category = event.target.value
            update_product_grid(category)
    
        # Initial setup
        try:
            category_select = document.getElementById("categorySelect")
            update_product_grid("all")  # Show all products initially
    
            # Add event listener for category selection
            category_select.addEventListener("change", create_proxy(on_category_change))
        except Exception as e:
            console.error(f"Error initializing: {e}")
    </script>
</body>
</html>