<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade'n Offer - My Products & Saved Collections</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', path='/trade_offer-style.css') }}">
    
    <script type="module" src="https://pyscript.net/releases/2023.11.1/core.js"></script>
    <style>

body {
    font-family: 'Roboto', Arial, sans-serif;
    margin: 0;
    background: linear-gradient(45deg, #000000, #1a1a1a, #000033, #000000);
    background-size: 200% 200%;
    animation: gradientBG 15s ease infinite;
    color: #FFFFFF;
    overflow-x: hidden;
    display: flex;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}



/* Main content container - centered properly */
.content {
    flex: 1;
    padding: 20px;
    margin-left: 106px; /* Same as sidebar width */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
}

/* Inner content wrapper to maintain proper centering */
.content-wrapper {
    width: 100%;
    max-width: 800px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Profile Header */
.profile-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
    width: 100%;
    max-width: 800px;
}

.profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background-color: #444444;
    object-fit: cover;
    border: 2px solid #FFD700;
}

.profile-info {
    flex-grow: 1;
}

.profile-name {
    font-size: 24px;
    font-weight: 600;
    margin: 0;
    color: #FFFFFF;
}

.profile-description {
    font-size: 14px;
    color: #CCCCCC;
    margin: 5px 0;
}

.edit-profile-btn {
    padding: 8px 16px;
    background-color: #3A3A3A;
    color: #FFFFFF;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s ease;
}

.edit-profile-btn:hover {
    background-color: #4A4A4A;
}

/* Tabs */
.tabs {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    border-bottom: 2px solid #444444;
    width: 100%;
    max-width: 800px;
}

.tab-button {
    padding: 10px 20px;
    background: none;
    border: none;
    color: #CCCCCC;
    font-size: 16px;
    cursor: pointer;
    transition: color 0.3s ease, border-bottom 0.3s ease;
    border-bottom: 2px solid transparent;
}

.tab-button.active {
    color: #FFFFFF;
    border-bottom: 2px solid #FFD700;
}

.tab-button:hover {
    color: #FFFFFF;
}

/* Tab Content */
.tab-content {
    width: 100%;
    max-width: 800px;
    flex-grow: 1;
    display: none;
}

.tab-content.active {
    display: block;
}

/* Scrollable Product and Saved Grids */
.scrollable-grid {
    max-height: 600px;
    overflow-y: auto;
    overflow-x: hidden;
    width: 100%;
    padding: 20px 0;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

.scrollable-grid::-webkit-scrollbar {
    width: 8px;
}

.scrollable-grid::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 10px;
}

.scrollable-grid::-webkit-scrollbar-thumb {
    background: transparent;
    border-radius: 10px;
}

.scrollable-grid::-webkit-scrollbar-thumb:hover {
    background: transparent;
}

/* Product Grid and Cards */
.product-grid, 
.saved-grid, 
.liked-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    width: 100%;
    justify-content: center;
}

.product-card, 
.saved-card, 
.liked-card {
    width: 100%;
    max-width: 250px;
    margin: 0 auto;
    background-color: #2D2D2D;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.product-card:hover, 
.saved-card:hover, 
.liked-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
}

.product-image, 
.saved-image, 
.liked-image {
    width: 100%;
    height: 200px;
    border-radius: 10px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid #444444;
    transition: opacity 0.3s ease;
}

.product-image:hover, 
.saved-image:hover, 
.liked-image:hover {
    opacity: 0.8;
}

.product-name, 
.saved-name, 
.liked-name {
    font-size: 18px;
    font-weight: 600;
    margin: 10px 0;
    color: #FFFFFF;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.product-description, 
.saved-description, 
.liked-description {
    font-size: 14px;
    color: #CCCCCC;
    margin: 5px 0;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.product-price, 
.saved-price, 
.liked-price {
    font-size: 16px;
    font-weight: 500;
    color: #FFD700;
    margin: 5px 0;
}

/* Heart icon for liked items */
.heart-icon {
    color: #ed4956;
    margin-right: 5px;
}

/* Edit Profile Popup */
.popup {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    justify-content: center;
    align-items: center;
}

.popup-content {
    background-color: #2D2D2D;
    padding: 30px;
    border-radius: 20px;
    width: 400px;
    max-width: 90%;
    max-height: 80vh;
    text-align: center;
    color: #FFFFFF;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s ease-out;
    overflow-y: auto;
    position: relative;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.close-btn {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 24px;
    cursor: pointer;
    color: #FFFFFF;
    transition: color 0.3s ease;
    background: none;
    border: none;
    padding: 5px 10px;
}

.close-btn:hover {
    color: #f44336;
}

.input-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
    margin-bottom: 20px;
}

input[type="text"], 
textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #444444;
    border-radius: 10px;
    background-color: #3A3A3A;
    color: #FFFFFF;
    font-size: 16px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

input[type="text"]:focus, 
textarea:focus {
    border-color: #FFD700;
    outline: none;
    box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
}

textarea {
    min-height: 100px;
    resize: vertical;
}

input[type="file"] {
    display: none;
}

.save-btn {
    padding: 12px 25px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.save-btn:hover {
    background-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.save-btn:active {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Ensure sidebar is visible */
#sidebar, 
#toggle-container {
    display: block !important;
    z-index: 9999 !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .content {
        margin-left: 0;
        padding: 10px;
    }

    .sidebar, #sidebar {
        display: none !important;
    }

    .profile-header {
        flex-direction: column;
        text-align: center;
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
    }

    .tabs {
        flex-direction: column;
        gap: 10px;
        border-bottom: none;
    }

    .tab-button {
        padding: 8px 16px;
    }

    .scrollable-grid {
        max-height: 400px;
    }

    .product-grid, 
    .saved-grid, 
    .liked-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .product-card, 
    .saved-card, 
    .liked-card {
        max-width: 200px;
    }

    .product-image, 
    .saved-image, 
    .liked-image {
        height: 150px;
    }
}

    </style>
</head>
<body>
    {% include 'component/sidenav.html' %}

    <!-- Main Content -->
    <div class="content">
        <!-- Profile Header -->
        <div class="profile-header">
            <img src="/static/image_test/profile_avatar.jpg" alt="Profile Avatar" class="profile-avatar">
            <div class="profile-info">
                <h2 class="profile-name">Trade'n Offer User</h2>
                <p class="profile-description">Online trading platform</p>
            </div>
            <button class="edit-profile-btn" id="editProfileBtn">Edit Profile</button>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" id="productsTab">Product</button>
            <button class="tab-button" id="likedTab">Liked Items</button>
            <button class="tab-button" id="savedTab">Saved Collections</button>
        </div>
        
        <!-- Tab Contents -->
        <div id="products-tab" class="tab-content active">
            <div class="scrollable-grid">
                <div class="product-grid" id="productsGrid"></div>
            </div>
        </div>
        <div id="liked-tab" class="tab-content">
            <div class="scrollable-grid">
                <div class="liked-grid" id="likedGrid"></div>
            </div>
        </div>
        <div id="saved-tab" class="tab-content">
            <div class="scrollable-grid">
                <div class="saved-grid" id="savedGrid"></div>
            </div>
        </div>
    </div>

    <!-- Simplified Edit Profile Popup (without image preview) -->
    <div id="editProfilePopup" class="popup">
        <div class="popup-content">
            <span class="close-btn" id="closeEditProfileBtn">×</span>
            <h2>Edit Profile</h2>
            <div class="input-container">
                <input type="text" id="editProfileName" placeholder="Enter username" value="Trade'n Offer User">
                <textarea id="editProfileDescription" placeholder="Enter profile description">Online trading platform</textarea>
                <input type="file" id="editProfileImage" accept="image/*" style="display: none;"> <!-- Hidden file input -->
            </div>
            <button type="button" class="save-btn" id="saveProfileBtn">Save</button>
        </div>
    </div>

    <!-- ฝัง script ตรงนี้ให้ทำงานโดยตรง -->
    <script type="py">
        from js import document, console, FileReader, window
        from pyodide.ffi import create_proxy
        
        # Sidebar toggle functionality
        menu_toggle = document.querySelector('.menu-toggle')
        sidebar = document.querySelector('.sidebar')
        
        def toggle_sidebar(event):
            if sidebar and menu_toggle:
                sidebar.classList.toggle('active')
                menu_toggle.classList.toggle('active')
        
        if menu_toggle:
            menu_toggle.addEventListener('click', create_proxy(toggle_sidebar))
        
        # Tab switching functionality
        def show_tab(tab_name, event=None):
            console.log(f"Switching to {tab_name} tab")
            
            tabs = document.querySelectorAll('.tab-content')
            buttons = document.querySelectorAll('.tab-button')

            # Remove active class from all tabs and buttons
            for tab in tabs:
                tab.classList.remove('active')
            for button in buttons:
                button.classList.remove('active')

            # Add active class to selected tab and button
            tab_content = document.getElementById(f"{tab_name}-tab")
            tab_button = document.getElementById(f"{tab_name}Tab")
            
            if tab_content:
                tab_content.classList.add('active')
            else:
                console.error(f"Tab content #{tab_name}-tab not found")
                
            if tab_button:
                tab_button.classList.add('active')
            else:
                console.error(f"Tab button #{tab_name}Tab not found")

            # Update URL hash
            window.location.hash = f"{tab_name}-tab"

            # Render content for the selected tab
            if tab_name == 'products':
                render_products()
            elif tab_name == 'saved':
                render_saved()
            elif tab_name == 'liked':
                render_liked()
            else:
                console.error(f"Unknown tab: {tab_name}")
        # Image preview functionality for profile image
        def handle_profile_image_change(event):
            try:
                files = event.target.files
                if files.length > 0:
                    file = files.item(0)
                    profile_preview = document.querySelector('.profile-avatar')
                    reader = FileReader.new()
                    
                    def on_load(e):
                        # Update preview image in the popup
                        profile_preview.src = e.target.result
                        # Store the image data in a data attribute to use when saving
                        document.getElementById('editProfileImage').setAttribute('data-image', e.target.result)
                        
                    reader.onload = create_proxy(on_load)
                    reader.readAsDataURL(file)
            except Exception as e:
                console.error(f"Error handling profile image change: {e}")
        
        # Edit Profile popup functions
        def open_edit_profile(event=None):
            try:
                # Get current values to populate the form
                current_name = document.querySelector('.profile-name').textContent
                current_description = document.querySelector('.profile-description').textContent
                current_image = document.querySelector('.profile-avatar').src
                
                # Set values in form
                document.getElementById('editProfileName').value = current_name
                document.getElementById('editProfileDescription').value = current_description
                
                # Show the custom file input and styles
                document.getElementById('profileImageSelect').style.display = 'block'
                
                # Display popup
                popup = document.getElementById('editProfilePopup')
                if popup:
                    popup.style.display = 'flex'
                else:
                    console.error("Edit profile popup not found")
            except Exception as e:
                console.error(f"Error opening profile popup: {e}")
        
        def close_edit_profile(event=None):
            popup = document.getElementById('editProfilePopup')
            if popup:
                popup.style.display = 'none'
            else:
                console.error("Edit profile popup not found")
        
        def save_profile_changes(event=None):
            try:
                name_input = document.getElementById('editProfileName')
                desc_input = document.getElementById('editProfileDescription')
                image_input = document.getElementById('editProfileImage')
                
                if not name_input or not desc_input:
                    console.error("Profile form elements not found")
                    return
                    
                name = name_input.value
                description = desc_input.value
                image_data = image_input.getAttribute('data-image')  # Get stored image data
        
                if name and description:
                    # Update profile name and description
                    name_element = document.querySelector('.profile-name')
                    desc_element = document.querySelector('.profile-description')
                    avatar_element = document.querySelector('.profile-avatar')
                    
                    if name_element:
                        name_element.textContent = name
                    if desc_element:
                        desc_element.textContent = description
                    
                    # Update profile image if a new one was selected
                    if image_data and avatar_element:
                        avatar_element.src = image_data
                        
                    close_edit_profile()
                    
                    # Show success feedback to user
                    feedback = document.createElement("div")
                    feedback.style.position = "fixed"
                    feedback.style.bottom = "20px"
                    feedback.style.right = "20px"
                    feedback.style.backgroundColor = "#4CAF50"
                    feedback.style.color = "white"
                    feedback.style.padding = "10px 20px"
                    feedback.style.borderRadius = "5px"
                    feedback.style.zIndex = "1000"
                    feedback.textContent = "Profile updated successfully!"
                    document.body.appendChild(feedback)
                    
                    # Remove feedback after 3 seconds
                    def remove_feedback():
                        document.body.removeChild(feedback)
                    window.setTimeout(create_proxy(remove_feedback), 3000)
                else:
                    console.error('Please fill in all required fields')
            except Exception as e:
                console.error(f"Error saving profile changes: {e}")
        
        # Simulated product data
        product_data = [
            {"id": 1, "name": "Laptop", "description": "Powerful laptop for gaming and work", "price": "999.99", "image": "/static/image_test/piano.jpg"},
            {"id": 2, "name": "Fashion", "description": "Stylish outfit for everyday wear", "price": "199.99", "image": "/static/image_test/guitar.jpg"},
            {"id": 3, "name": "Sofa", "description": "Comfortable modern sofa for living room", "price": "599.99", "image": "/static/image_test/camera.jpg"},
            {"id": 4, "name": "Lamp", "description": "Elegant floor lamp for home decor", "price": "89.99", "image": "/static/image_test/guitar.jpg"},
            {"id": 5, "name": "Sports Gear", "description": "Complete set of sports equipment", "price": "299.99", "image": "/static/image_test/piano.jpg"},
            {"id": 6, "name": "Books", "description": "Collection of classic literature books", "price": "149.99", "image": "/static/image_test/camera.jpg"}
        ]
        
        # Simulated saved collections data
        saved_data = [
            {"id": 1, "name": "Beads", "description": "Colorful beads for crafting", "price": "49.99", "image": "/static/image_test/guitar.jpg"},
            {"id": 2, "name": "Fashion", "description": "Trendy jacket for all seasons", "price": "129.99", "image": "/static/image_test/piano.jpg"},
            {"id": 3, "name": "Books", "description": "Set of educational books", "price": "89.99", "image": "/static/image_test/guitar.jpg"}
        ]
        
        # Simulated liked items data
        liked_data = [
            {"id": 1, "name": "Camera", "description": "High-quality digital camera for photography", "price": "499.99", "image": "/static/image_test/camera.jpg"},
            {"id": 2, "name": "Guitar", "description": "Acoustic guitar for beginners and professionals", "price": "299.99", "image": "/static/image_test/guitar.jpg"},
            {"id": 3, "name": "Piano", "description": "Digital piano with 88 keys and weighted action", "price": "799.99", "image": "/static/image_test/piano.jpg"},
            {"id": 4, "name": "Headphones", "description": "Noise-canceling headphones with premium sound", "price": "199.99", "image": "/static/image_test/camera.jpg"},
            {"id": 5, "name": "Watch", "description": "Luxury smartwatch with fitness tracking", "price": "349.99", "image": "/static/image_test/piano.jpg"},
            {"id": 6, "name": "Smartphone", "description": "Latest model smartphone with advanced features", "price": "699.99", "image": "/static/image_test/guitar.jpg"}
        ]

        
        
        # Functions to render content for each tab
        def render_products(event=None):
            product_grid = document.getElementById('productsGrid')
            if not product_grid:
                console.error("Product grid element (#productsGrid) not found!")
                return
            product_grid.innerHTML = ''
            for product in product_data:
                product_div = document.createElement('div')
                product_div.classList.add('product-card')
        
                img = document.createElement('img')
                img.src = product['image']
                img.alt = product['name']
                img.classList.add('product-image')
        
                name = document.createElement('div')
                name.classList.add('product-name')
                name.textContent = product['name']
        
                description = document.createElement('div')
                description.classList.add('product-description')
                description.textContent = product['description']
        
                price = document.createElement('div')
                price.classList.add('product-price')
                price.textContent = f"${product['price']}"
        
                product_div.appendChild(img)
                product_div.appendChild(name)
                product_div.appendChild(description)
                product_div.appendChild(price)
                product_grid.appendChild(product_div)
            console.log("Products rendered successfully")
        
        def render_saved(event=None):
            saved_grid = document.getElementById('savedGrid')
            if not saved_grid:
                console.error("Saved grid element (#savedGrid) not found!")
                return
            saved_grid.innerHTML = ''
            for item in saved_data:
                saved_div = document.createElement('div')
                saved_div.classList.add('saved-card')
        
                img = document.createElement('img')
                img.src = item['image']
                img.alt = item['name']
                img.classList.add('saved-image')
        
                name = document.createElement('div')
                name.classList.add('saved-name')
                name.textContent = item['name']
        
                description = document.createElement('div')
                description.classList.add('saved-description')
                description.textContent = item['description']
        
                price = document.createElement('div')
                price.classList.add('saved-price')
                price.textContent = f"${item['price']}"
        
                saved_div.appendChild(img)
                saved_div.appendChild(name)
                saved_div.appendChild(description)
                saved_div.appendChild(price)
                saved_grid.appendChild(saved_div)
            console.log("Saved collections rendered successfully")
        
        def render_liked(event=None):
            liked_grid = document.getElementById('likedGrid')
            if not liked_grid:
                console.error("Liked grid element (#likedGrid) not found!")
                return
            liked_grid.innerHTML = ''
            for item in liked_data:
                liked_div = document.createElement('div')
                liked_div.classList.add('liked-card')
        
                img = document.createElement('img')
                img.src = item['image']
                img.alt = item['name']
                img.classList.add('liked-image')
        
                name_container = document.createElement('div')
                name_container.classList.add('liked-name')
                
                # Add heart icon
                heart_icon = document.createElement('i')
                heart_icon.classList.add('fas', 'fa-heart', 'heart-icon')
                name_container.appendChild(heart_icon)
                
                # Add name text
                name_text = document.createTextNode(item['name'])
                name_container.appendChild(name_text)
        
                description = document.createElement('div')
                description.classList.add('liked-description')
                description.textContent = item['description']
        
                price = document.createElement('div')
                price.classList.add('liked-price')
                price.textContent = f"${item['price']}"
        
                liked_div.appendChild(img)
                liked_div.appendChild(name_container)
                liked_div.appendChild(description)
                liked_div.appendChild(price)
                liked_grid.appendChild(liked_div)
            console.log("Liked items rendered successfully")


        # ในฟังก์ชัน initialize() ให้เพิ่มโค้ดนี้ก่อนส่วน render_products()
        def check_hash_and_show_tab():
            try:
                hash = window.location.hash
                if hash == "#liked-tab":
                    show_tab("liked")
            except Exception as e:
                console.error(f"Error checking hash: {e}")
        

        
        def initialize():
            try:
                # Create the custom file input wrapper
                file_input_container = document.createElement("div")
                file_input_container.id = "profileImageSelect"
                file_input_container.className = "custom-file-input"
                file_input_container.style.display = "none"
                file_input_container.style.marginBottom = "15px"
                file_input_container.style.textAlign = "center"
                
                # Create the label for the file input
                file_label = document.createElement("label")
                file_label.htmlFor = "editProfileImage"
                file_label.style.display = "inline-block"
                file_label.style.padding = "10px 15px"
                file_label.style.backgroundColor = "#3A3A3A"
                file_label.style.color = "#FFFFFF"
                file_label.style.borderRadius = "6px"
                file_label.style.cursor = "pointer"
                file_label.style.transition = "background-color 0.3s"
                file_label.innerHTML = '<i class="fas fa-camera"></i> Choose Profile Image'
                
                # Add hover effect
                file_label.addEventListener("mouseover", create_proxy(lambda e: 
                    e.target.style.setProperty("background-color", "#4A4A4A")))
                file_label.addEventListener("mouseout", create_proxy(lambda e: 
                    e.target.style.setProperty("background-color", "#3A3A3A")))
                
                # Add the file input and label to the container
                file_input_container.appendChild(file_label)
                
                # Get the edit profile popup content
                popup_content = document.querySelector("#editProfilePopup .popup-content")
                
                if popup_content:
                    # Insert the file input container after the heading
                    heading = popup_content.querySelector("h2")
                    if heading:
                        heading.insertAdjacentElement("afterend", file_input_container)
                
                # Setup event listeners for tab switching
                productsTab = document.getElementById("productsTab")
                likedTab = document.getElementById("likedTab")
                savedTab = document.getElementById("savedTab")
                
                if productsTab:
                    productsTab.addEventListener("click", create_proxy(lambda e: show_tab("products", e)))
                else:
                    console.error("Products tab not found")
                    
                if likedTab:
                    likedTab.addEventListener("click", create_proxy(lambda e: show_tab("liked", e)))
                else:
                    console.error("Liked tab not found")
                    
                if savedTab:
                    savedTab.addEventListener("click", create_proxy(lambda e: show_tab("saved", e)))
                else:
                    console.error("Saved tab not found")
                    
                # Setup event listeners for profile editing
                editProfileBtn = document.getElementById("editProfileBtn")
                closeEditProfileBtn = document.getElementById("closeEditProfileBtn")
                saveProfileBtn = document.getElementById("saveProfileBtn")
                editProfileImage = document.getElementById("editProfileImage")
                
                if editProfileBtn:
                    editProfileBtn.addEventListener("click", create_proxy(open_edit_profile))
                if closeEditProfileBtn:
                    closeEditProfileBtn.addEventListener("click", create_proxy(close_edit_profile))
                if saveProfileBtn:
                    saveProfileBtn.addEventListener("click", create_proxy(save_profile_changes))
                if editProfileImage:
                    editProfileImage.addEventListener("change", create_proxy(handle_profile_image_change))
                    # Make the file input visible to the label
                    file_label.appendChild(editProfileImage)

                
                # Initialize with Products tab active
                render_products()
                check_hash_and_show_tab()
                
            except Exception as e:
                console.error(f"Error during initialization: {e}")
        
        # Run initialization
        initialize()
    </script>
</body>
</html>